<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoMind</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&libraries=places"></script>
    <script>
        function initMap() {
            fetch('/find-disposal')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }
                    
                    console.log("Disposal data:", data); // Log data for debugging
                    
                    const map = new google.maps.Map(document.getElementById('map'), {
                        center: {lat: data.current_location[0], lng: data.current_location[1]},
                        zoom: 12
                    });

                    const currentLocationMarker = new google.maps.Marker({
                        position: {lat: data.current_location[0], lng: data.current_location[1]},
                        map: map,
                        title: "Current Location"
                    });

                    const disposalLocationMarker = new google.maps.Marker({
                        position: {lat: data.closest_disposal.location[0], lng: data.closest_disposal.location[1]},
                        map: map,
                        title: data.closest_disposal.name
                    });

                    const directionsService = new google.maps.DirectionsService();
                    const directionsRenderer = new google.maps.DirectionsRenderer();
                    directionsRenderer.setMap(map);

                    const request = {
                        origin: currentLocationMarker.getPosition(),
                        destination: disposalLocationMarker.getPosition(),
                        travelMode: 'DRIVING'
                    };

                    directionsService.route(request, function(result, status) {
                        if (status == 'OK') {
                            directionsRenderer.setDirections(result);
                        } else {
                            alert('Directions request failed due to ' + status);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching disposal data:', error);
                    alert('Error fetching disposal data: ' + error.message);
                });
        }
    </script>
</head>

<body onload="initMap()">
    <header>
        <div class="main-content">
            <div class="navbar">
                <div class="logo">
                    <img src="static/logo.png" alt="EcoMind Logo">
                    <span>EcoMind</span>
                </div>
                <div class="auth-links">
                    <a href="#">Login</a> | <a href="#">Register</a>
                </div>
            </div>
            <div class="body">
                <p>Body Content</p>
            </div>
        </div>
    </header>
    <main>
        <section>
            <div class="navbar">
                <h2>Find Your Nearest Electrical Waste Disposal Location</h2>
            </div>
            <div id="map" style="height: 500px; width: 100%;"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2022 Eco Educational Site. All rights reserved.</p>
    </footer>
</body>
</html>
